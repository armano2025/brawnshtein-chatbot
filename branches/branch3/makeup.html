<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>השלמת שיעור – מנוי/ה קיים/ת</title>

  <!-- קובץ עיצוב בשורש הפרויקט → שתי רמות מעלה -->
  <link rel="stylesheet" href="../../styles.light.css?v=1" />
  <meta name="theme-color" content="#5b7cfa" />

  <style>
    #area{ overflow-y:auto; max-height:70vh; scroll-behavior:smooth }
    .btn.primary {
      background: var(--btn-bg, #f3f4f6) !important;
      color: var(--btn-fg, #111827) !important;
      border-color: var(--btn-border, #e5e7eb) !important;
    }
    .btn.next-arrow::after{ content:""; }
    /* הודעת שגיאה נעימה אם משהו נופל מוקדם */
    .boot-error{ padding:12px; border-radius:12px; background:#fff3f3; color:#b91c1c; border:1px solid #fecaca; margin:12px }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <!-- טופ־בר -->
      <div class="topbar" style="display:flex;gap:8px;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--card-brd,#e6eaf3);background:linear-gradient(180deg,rgba(255,255,255,.45),rgba(255,255,255,.2));backdrop-filter: blur(6px);">
        <div class="right" style="display:flex;gap:8px;align-items:center">
          <button class="btn" onclick="location.href='index.html'">תפריט מנוי/ה</button>
          <button class="btn" onclick="location.href='../../index.html'">לתפריט ראשי</button>
        </div>
        <div class="left" style="display:flex;gap:8px;align-items:center">
          <a id="faqBtn" class="btn ghost" href="../../faq.html" target="_blank" rel="noopener">יש לי שאלות</a>
        </div>
      </div>

      <!-- כותרת -->
      <div class="head">
        <div class="brand">
          <div class="logo">HB</div>
          <div class="title">השלמת שיעור</div>
        </div>
      </div>

      <!-- אזור התוכן -->
      <div class="body chat-body" id="area" role="log" aria-live="polite" aria-atomic="false">
        <!-- fallback קטן עד שה־JS מצייר -->
        <div class="bubble bot">טוען…</div>
      </div>

      <!-- תחתית -->
      <div class="footer">
        <button id="backBtn" class="btn" disabled>חזרה</button>
        <span class="spacer"></span>
      </div>

    </div>
  </div>

  <!-- קבצים משותפים (ב-branches/js) – חשוב לטעון לפני הזרימה -->
  <script defer src="../js/config.js?v=3"></script>
  <script defer src="../js/chat-helpers.js?v=3"></script>

  <!-- הזרימה הספציפית -->
  <script defer src="./js/flows/makeup.js?v=2"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      try{
        // כפתור חזרה בתוך הזרימה
        const backBtn = document.getElementById('backBtn');
        if (backBtn) backBtn.onclick = ()=> window.Chat?.goBack?.();

        // FAQ עם הקשר
        (function setHelpContext(ctx){
          const btn = document.getElementById('faqBtn');
          if(!btn) return;
          const base='../../faq.html';
          btn.href = ctx ? `${base}?ctx=${encodeURIComponent(ctx)}` : base;
        })('branch3-makeup');

        // הפעלת הזרימה
        if (window.MakeupFlow?.start) {
          window.MakeupFlow.start();
        } else {
          throw new Error('MakeupFlow לא נטען (בדוק נתיבי סקריפטים)');
        }
      }catch(err){
        console.error(err);
        const area = document.getElementById('area');
        if(area){
          const d=document.createElement('div');
          d.className='boot-error';
          d.textContent='אופס… משהו הפריע לטעינה. רענון יעזור, ואם לא — בדוק קונסול.';
          area.appendChild(d);
        }
      }
    });
  </script>
</body>
</html>