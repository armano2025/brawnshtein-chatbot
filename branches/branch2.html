<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×× ×•×™ ×—×•×“×©×™ â€“ ×¤×¨×˜×™× ×•×”×¨×©××”</title>

  <!-- ×¢×™×¦×•×‘ ×’×œ×•×‘×œ×™ ×‘×”×™×¨ ×•××—×™×“ -->
  <link rel="stylesheet" href="../styles.light.css?v=1" />
  <meta name="theme-color" content="#5b7cfa" />

  <!-- ×¡×’× ×•× ×•×ª ×œ××¡×š ×”××§×¦×•×¢×•×ª ×•×”××•×“××œ -->
  <style>
    /* ×’×¨×™×“ ××§×¦×•×¢×•×ª: ×¨×¡×¤×•× ×¡×™×‘×™ ×•× ×§×™ */
    .subjects-grid{
      display:grid; gap:10px; margin-top:6px;
      grid-template-columns: 1fr;
    }
    @media (min-width:560px){ .subjects-grid{ grid-template-columns: 1fr 1fr } }
    @media (min-width:920px){ .subjects-grid{ grid-template-columns: 1fr 1fr 1fr } }

    .subject-card{
      background:#fff; border:1px solid var(--border);
      border-radius:12px; padding:12px 14px; cursor:pointer;
      box-shadow: 0 6px 14px rgba(15,23,42,0.06);
      transition: transform var(--speed), border-color var(--speed), box-shadow var(--speed);
      display:flex; align-items:center; gap:10px; width:100%; text-align:right;
    }
    .subject-card:hover{ transform: translateY(-1px); border-color: var(--primary); box-shadow: 0 8px 18px rgba(15,23,42,0.10) }
    .subject-emoji{ font-size:18px; }
    .subject-title{ font-weight:700; }

    /* ××•×“××œ ××™×“×¢ ××§×¦×•×¢: ×§×œ×™×œ ×•×©×§×•×£ */
    .modal{
      position:fixed; inset:0; z-index:50;
      background: rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    .modal-card{
      max-width: 640px; width:100%;
      background: var(--glass); border:1px solid var(--border);
      border-radius: 16px; box-shadow: var(--shadow);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px; border-bottom:1px solid var(--border);
      background: linear-gradient(135deg, rgba(91,124,250,.14), rgba(124,91,250,.10));
      font-weight:800;
    }
    .modal-body{ padding:12px 14px; line-height:1.8; color: var(--text) }
    .modal-actions{
      display:flex; gap:8px; justify-content:flex-end; padding:12px 14px; border-top:1px solid var(--border);
      background: #ffffff;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <!-- ×˜×•×¤Ö¾×‘×¨ -->
      <div class="topbar">
        <button class="btn" onclick="location.href='../index.html'">×œ×ª×¤×¨×™×˜ ×¨××©×™</button>
      </div>

      <!-- ×›×•×ª×¨×ª -->
      <div class="head">
        <div class="brand">
          <div class="logo">HB</div>
          <div class="title">×× ×•×™ ×—×•×“×©×™ â€“ ×¤×¨×˜×™× ×•×”×¨×©××”</div>
        </div>
      </div>

      <!-- ××–×•×¨ ×”×ª×•×›×Ÿ -->
      <div class="body chat-body" id="area" role="log" aria-live="polite" aria-atomic="false"></div>

      <!-- ×ª×—×ª×™×ª: ×—×–×¨×” + ×©××œ×•×ª (FAQ) -->
      <div class="footer">
        <button id="backBtn" class="btn" disabled>×—×–×¨×”</button>
        <a id="faqBtn" class="btn ghost" href="../faq.html" target="_blank" rel="noopener">×™×© ×œ×™ ×©××œ×•×ª</a>
        <span class="spacer"></span>
      </div>

    </div>
  </div>

  <!-- ×§×‘×¦×™× ××©×•×ª×¤×™× (×›××• ×‘×¢× ×£ 1) -->
  <script src="./js/config.js?v=2"></script>
  <script src="./js/chat-helpers.js?v=2"></script>

  <script>
    /* ===== ×”×ª×××ª ×›×¤×ª×•×¨ ×”â€‘FAQ ×œ×¤×™ ×”×§×©×¨ ===== */
    function setHelpContext(ctx){
      const btn = document.getElementById('faqBtn');
      if(!btn) return;
      const base = '../faq.html';
      btn.href = ctx ? `${base}?ctx=${encodeURIComponent(ctx)}` : base;
    }

    /* ===== ×§×™×©×•×¨×™× ××ª×¦×•×¨×” (×¢× fallback) ===== */
    const REG_LINK   = (window.Chat?.cfg?.REG_LINK)   || 'https://wordpress-1184560-4777160.cloudwaysapps.com/';
    const TERMS_LINK = (window.Chat?.cfg?.TERMS_LINK) || 'https://forms.gle/orUvvLrrSuCGAPVVA';

    /* ===== ×ª×•×›×Ÿ ××§×¦×•×¢×•×ª ×•×ª×™××•×¨×™× ===== */
    const SUBJECTS = (Chat?.cfg?.SUBJECTS && Chat.cfg.SUBJECTS.length)
      ? Chat.cfg.SUBJECTS
      : ['××ª××˜×™×§×”','×× ×’×œ×™×ª','×× ×’×œ×™×ª ××“×•×‘×¨×ª ×œ×§×˜× ×˜× ×™×','×œ×©×•×Ÿ','×¡×¤×¨×•×ª','×”×™×¡×˜×•×¨×™×”','×ª× "×š','×¤×™×–×™×§×”','×›×™××™×”','×‘×™×•×œ×•×’×™×”','××“×¢×™ ×”××—×©×‘'];

    const SUBJECT_INFO = {
      '××ª××˜×™×§×”': '×™×™×©×•×¨ ×§×• ×‘×—×•××¨ ×”×›×™×ª×ª×™, ×—×™×–×•×§ ×™×¡×•×“×•×ª, ××¡×˜×¨×˜×’×™×•×ª ×¤×ª×¨×•×Ÿ ×•×ª×¨×’×•×œ ×××•×§×“ â€” ×¢× ×“×’×© ×¢×œ ×‘×™×˜×—×•×Ÿ ×•×”×›× ×” ×œ××‘×—× ×™×.',
      '×× ×’×œ×™×ª': '×©×¤×” ×—×™×”: ××•×¦×¨ ××™×œ×™×, ×“×§×“×•×§ ×©×™××•×©×™, ×§×¨×™××”, ×›×ª×™×‘×” ×•×“×™×‘×•×¨ â€” ×‘×§×¦×‘ ××™×©×™ ×•×ª×™×§×•×Ÿ ×˜×¢×•×™×•×ª ×¢×“×™×Ÿ.',
      '×× ×’×œ×™×ª ××“×•×‘×¨×ª ×œ×§×˜× ×˜× ×™×': '××¡×œ×•×œ ××©×—×§×™ ×•×—×•×•×™×™×ª×™: ×¦×œ×™×œ×™×, ××™×œ×™× ×¨××©×•× ×•×ª, ×©×™×¨×™× ×•××©×—×§×™ ×“×™×‘×•×¨ ×œ×”×˜××¢×” ×˜×‘×¢×™×ª ××’×™×œ ×¦×¢×™×¨.',
      '×œ×©×•×Ÿ': '×”×‘× ×” ×•×”×‘×¢×”, ×ª×—×‘×™×¨, × ×™×ª×•×— ×˜×§×¡×˜×™× ×•×“×™×•×§ â€” ×›×“×™ ×œ×›×ª×•×‘ ×•×œ× ×¡×— ×‘×‘×™×˜×—×•×Ÿ.',
      '×¡×¤×¨×•×ª': '×§×¨×™××” ××•× ×—×™×ª, ×¤×™×¨×•×§ ×©×›×‘×•×ª ×‘×˜×§×¡×˜, ×›×œ×™× ×œ× ×™×ª×•×— ×•×›×ª×™×‘×ª ×ª×©×•×‘×•×ª ××œ××•×ª.',
      '×”×™×¡×˜×•×¨×™×”': '×¦×™×¨×™ ×–××Ÿ, ×”×§×©×¨×™× ×•××™×¨×•×¢×™× â€” ××™×š ××¡×¤×¨×™× ×¡×™×¤×•×¨ ×‘×¨×•×¨ ×•×¢×•× ×™× ×ª×©×•×‘×” ×©××§×‘×œ×ª × ×§×•×“×•×ª.',
      '×ª× "×š': '×§×¨×™××” ××•× ×—×™×ª, ××•×©×’×™× ×•×”×‘× ×ª ×¤×¨×§×™× â€” ×¢× ×˜×›× ×™×§×•×ª ×–×™×›×¨×•×Ÿ ×•×§×™×©×•×¨×™×•×ª.',
      '×¤×™×–×™×§×”': '×¢×§×¨×•× ×•×ª, ×¤×™×¨×•×§ ×‘×¢×™×•×ª ×©×œ×‘Ö¾×©×œ×‘, ×ª×¨×’×•×œ ×©×™×˜×ª×™ ×•×”×›× ×” ×œ×‘×—×™× ×•×ª.',
      '×›×™××™×”': '××•×œ×§×•×œ×•×ª, ×ª×’×•×‘×•×ª, ×—×™×©×•×‘×™× â€” ×¤×™×©×•×˜ × ×•×©××™× ×××ª×’×¨×™× ×•××™×•×× ×•×™×•×ª ×¤×ª×¨×•×Ÿ.',
      '×‘×™×•×œ×•×’×™×”': '××¢×¨×›×•×ª ×’×•×£, ×ª××™× ×•×ª×”×œ×™×›×™× â€” ×œ×™××•×“ ×‘×”×™×¨ ×¢× ×“×•×’×××•×ª ×•×ª×¨×’×•×œ ×œ××‘×—× ×™×.',
      '××“×¢×™ ×”××—×©×‘': '×œ×•×’×™×§×”, ×™×¡×•×“×•×ª ×ª×›× ×•×ª ×•×ª×¨×’×•×œ ××¢×©×™ â€” ×‘×”×ª×× ×œ×¨××” ×•×œ×¡×™×œ×‘×•×¡.'
    };

    const SUBJECT_EMOJI = {
      '××ª××˜×™×§×”':'ğŸ§®','×× ×’×œ×™×ª':'ğŸ—£ï¸','×× ×’×œ×™×ª ××“×•×‘×¨×ª ×œ×§×˜× ×˜× ×™×':'ğŸˆ','×œ×©×•×Ÿ':'âœï¸','×¡×¤×¨×•×ª':'ğŸ“–',
      '×”×™×¡×˜×•×¨×™×”':'ğŸ—ºï¸','×ª× "×š':'ğŸ“œ','×¤×™×–×™×§×”':'âš›ï¸','×›×™××™×”':'ğŸ§ª','×‘×™×•×œ×•×’×™×”':'ğŸ§¬','××“×¢×™ ×”××—×©×‘':'ğŸ’»'
    };

    /* ===== ××•×“××œ ××™×“×¢ ×§×¦×¨ ===== */
    function openSubjectModal(title, html){
      const wrap = document.createElement('div');
      wrap.className = 'modal';
      wrap.setAttribute('role','dialog');
      wrap.setAttribute('aria-modal','true');

      const card = document.createElement('div');
      card.className = 'modal-card';

      const head = document.createElement('div');
      head.className = 'modal-head';
      head.innerHTML = `<div>${title}</div>`;

      const body = document.createElement('div');
      body.className = 'modal-body';
      body.innerHTML = html;

      const actions = document.createElement('div');
      actions.className = 'modal-actions';
      const closeBtn = document.createElement('button');
      closeBtn.className = 'btn';
      closeBtn.textContent = '×¡×’×•×¨';
      closeBtn.onclick = ()=> wrap.remove();
      actions.appendChild(closeBtn);

      card.append(head, body, actions);
      wrap.appendChild(card);

      wrap.addEventListener('click', (e)=>{ if(e.target===wrap) wrap.remove(); });
      document.addEventListener('keydown', function onEsc(ev){ if(ev.key==='Escape'){ wrap.remove(); document.removeEventListener('keydown', onEsc); } });

      document.body.appendChild(wrap);
      closeBtn.focus();
    }

    /* ===== ×”×ª×—×œ×” ===== */
    function start(){
      setHelpContext('contact');
      Chat.clear(); Chat.push(start);

      Chat.typingThen(
        '<strong>×”×™×™! ×× ×•×™ ×—×•×“×©×™ ×‘××¨×›×– ×‘×¨××•× ×©×˜×™×™×Ÿ ğŸ‘¨â€ğŸš€</strong><br>' +
        '× ×¢×‘×•×¨ ×©×œ×•×©×” ×¦×¢×“×™× ×§×œ×™× ×•× ×—×–×•×¨ ××œ×™×š ×œ×”××©×š.',
        650, true
      );

      setTimeout(stepContact, 800);
    }

    /* ===== ×©×œ×‘ 1: ×¤×¨×˜×™ ×§×©×¨ (AskContact ××ª×•×š helpers) ===== */
    async function stepContact(){
      setHelpContext('contact');
      Chat.clear(); Chat.push(stepContact);

      const contact = await Chat.askContact({
        titleHtml: '<strong>×¤×¨×˜×™ ×§×©×¨</strong><br><span class="muted">×©× ×¤×¨×˜×™, ×©× ××©×¤×—×” ×•××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ×—×–×¨×”</span> ğŸ‘¨â€ğŸš€',
        nextText: '×”××©×š',
        requireLast: true,
        showBack: false
      });
      if(!contact) return;

      Chat.State.data.firstName = contact.firstName;
      Chat.State.data.lastName  = contact.lastName;
      Chat.State.data.fullName  = `${contact.firstName} ${contact.lastName}`.trim();
      Chat.State.data.phone     = contact.phone;

      // ×©××™×¨×” ×§×¦×¨×” ×œ××–×›×™×¨×•×ª
      const stop = Chat.showProcessing('×©×•××¨ ×œ××–×›×™×¨×•×ªâ€¦');
      const ok = await Chat.sendLeadToSheet({
        path: '×× ×•×™ ×—×•×“×©×™ â€“ ×”×ª×¢× ×™×™× ×•×ª',
        fullName: Chat.State.data.fullName,
        firstName: Chat.State.data.firstName,
        lastName:  Chat.State.data.lastName,
        phone: Chat.State.data.phone,
        message: '',
        extraNotes: '',
        cta: '×”×ª×¢× ×™×™× ×•×ª ×‘×× ×•×™ ×—×•×“×©×™',
        source: '×™×•×¡×˜×•×Ÿ â€“ ××ª×¨',
        status: '×œ×˜×™×¤×•×œ',
        createdAt: new Date().toISOString()
      });
      stop();
      if(!ok){
        Chat.botText('×œ× ×”×¦×œ×—× ×• ×œ×©××•×¨ ××ª ×”×¤×¨×˜×™× âŒ ××¤×©×¨ ×œ×”××©×™×š ×‘×›×œ ×–××ª, ×•× × ×¡×” ×©×•×‘ ×‘×”××©×š.').classList.add('err');
      }

      stepSubjects();
    }

    /* ===== ×©×œ×‘ 2: ××§×¦×•×¢×•×ª (×’×¨×™×“ + ××•×“××œ×™×) ===== */
    function stepSubjects(){
      setHelpContext('subject');
      Chat.clear(); Chat.push(stepSubjects);

      const name = Chat.State.data.firstName ? `, ${Chat.State.data.firstName}` : '';
      Chat.typingThen(
        `<strong>××” ××¢× ×™×™×Ÿ ××ª×›×${name}?</strong><br>` +
        `<span class="muted">×œ×—×™×¦×” ×¢×œ ××§×¦×•×¢ ×ª×¤×ª×— ×”×¡×‘×¨ ×§×¦×¨ ×¢×œ ××™×š ×× ×—× ×• ×¢×•×‘×“×™× ×‘×•.</span>`,
        600, true
      );

      setTimeout(()=>{
        const host = document.createElement('div'); host.className='bubble bot';
        const grid = document.createElement('div'); grid.className='subjects-grid';

        // ×¨×™×©×•× ×œ×—×™×¦×•×ª (××•×¤×¦×™×•× ×œ×™)
        const viewed = new Set();

        SUBJECTS.forEach(title=>{
          const card = document.createElement('button');
          card.type = 'button';
          card.className = 'subject-card';
          card.innerHTML = `
            <span class="subject-emoji">${SUBJECT_EMOJI[title] || 'ğŸ“š'}</span>
            <span class="subject-title">${title}</span>
          `;
          card.addEventListener('click', ()=>{
            const txt = SUBJECT_INFO[title] || '×œ×™××•×“ ××•×ª××Ö¾××™×©×™×ª: ×—×™×–×•×§ ×™×¡×•×“×•×ª, ×ª×¨×’×•×œ ××•×“×¨×š ×•×”×›× ×” ×œ××‘×—× ×™× â€” ×‘×§×¦×‘ × ×¢×™× ×•×‘×¨×•×¨.';
            openSubjectModal(title, `<p>${txt}</p>`);
            viewed.add(title);
          });
          grid.appendChild(card);
        });

        host.appendChild(grid);
        document.getElementById('area').appendChild(host);
        (function(){ const a=document.getElementById('area'); a.scrollTop=a.scrollHeight; })();

        Chat.button('×”××©×š', ()=>{
          Chat.userBubble('×”××©×š');
          Chat.State.data.subjectsViewed = Array.from(viewed);
          stepRegistration();
        }, 'btn primary');

        // ×ª×–×›×•×¨×ª ×§×˜× ×”/×¡×™×›×•×
        const s = document.createElement('div'); s.className='summary';
        s.appendChild(Chat.chip('×× ×•×™ ×—×•×“×©×™'));
        if (Chat.State.data.subjectsViewed?.length){
          s.appendChild(Chat.chip(`× ×¤×ª×—×•: ${Chat.State.data.subjectsViewed.length} ××§×¦×•×¢×•×ª`));
        }
        document.getElementById('area').appendChild(s);
      }, 700);
    }

    /* ===== ×©×œ×‘ 3: ×§×™×©×•×¨ ×œ×”××©×š (×”×¤× ×™×” ×œ×˜×•×¤×¡ ×”××“×•×™×§) ===== */
    function stepRegistration(){
      setHelpContext('review');
      Chat.clear(); Chat.push(stepRegistration);

      Chat.botHTML(
        '<strong>×“×™×•×§ ×”×¦×¨×›×™× ×•×”×¨×¦×•× ×•×ª</strong><br>' +
        '×›×“×™ ×œ×”×ª××™× ×œ×›× ××ª ×”××•×¨×”, ×”×¨××” ×•×”×©×¢×•×ª ×‘×¦×•×¨×” ×”×˜×•×‘×” ×‘×™×•×ª×¨ â€” ×”×™×›× ×¡×• ×œ×˜×•×¤×¡ ×”×”××©×š ×”×§×¦×¨ ×©×œ× ×•.'
      );

      Chat.button('×¤×ª×—/×™ ××ª ×˜×•×¤×¡ ×”×”××©×š ğŸ“', ()=>{
        Chat.userBubble('×¤×ª×—/×™ ××ª ×˜×•×¤×¡ ×”×”××©×š');
        window.open(REG_LINK, '_blank', 'noopener,noreferrer');
        Chat.sendLeadToSheet?.({
          path: '×× ×•×™ ×—×•×“×©×™ â€“ ××¢×‘×¨ ×œ×˜×•×¤×¡',
          fullName: Chat.State.data.fullName || '',
          phone: Chat.State.data.phone || '',
          message: '× ×¤×ª×— ×˜×•×¤×¡ ×”××©×š ××”×¨×•×‘×•×˜',
          cta: '×¤×ª×™×—×ª ×˜×•×¤×¡',
          source: '×™×•×¡×˜×•×Ÿ â€“ ××ª×¨',
          status: '×œ×˜×™×¤×•×œ',
          createdAt: new Date().toISOString()
        });
      }, 'btn primary');

      Chat.button('××¡×™×™× ×××•×—×¨ ×™×•×ª×¨ â³', ()=>{
        Chat.userBubble('××¡×™×™× ×××•×—×¨ ×™×•×ª×¨');
        Chat.typingThen('×¡×’×•×¨ ğŸ™‚ ×©××¨×ª×™ ××ª ×”×¤×¨×˜×™× ×•× ×™×¦×•×¨ ×§×©×¨ ×‘×§×¨×•×‘ ×œ×¢×–×¨×” ×‘×”×©×œ××ª ×”×”×¨×©××”.', 600, true);
      });

      // ×¡×™×•× ×™×¤×” ×•× ×¢×™×
      const wrap = document.createElement('div'); wrap.className='bubble bot';
      const fn = Chat.State.data.firstName || '';
      wrap.innerHTML =
        `<div class="summary" style="margin-bottom:10px;">
           <span class="chip">×©×™×¢×•×¨ = 50 ×“×§×³</span>
           <span class="chip">××³â€“×”×³ 14:00â€“21:00</span>
           <span class="chip">×”×ª×××” ××™×©×™×ª</span>
         </div>
         <div class="muted">×”×™×™${fn ? ' ' + fn : ''}, ×›××Ÿ ×™×•×¡×˜×•×Ÿ ğŸ‘¨â€ğŸš€ ×× ×™ ××“××’ ×©×™×—×–×¨×• ××œ×™×™×š ×‘×”×§×“×.
         ×•×‘×™× ×ª×™×™× â€” ×× ××©×”×• ×œ× ×‘×¨×•×¨, ×”Ö¾<a href="../faq.html" target="_blank" rel="noopener">×©××œ×•×ª ×•×ª×©×•×‘×•×ª</a> ×ª××™×“ ×›××Ÿ.</div>`;
      document.getElementById('area').appendChild(wrap);
      (function(){ const a=document.getElementById('area'); a.scrollTop=a.scrollHeight; })();

      Chat.button('×—×–×¨×” ×œ×ª×¤×¨×™×˜ ×”×¨××©×™', ()=> location.href='../index.html');
    }

    // ×”×¤×¢×œ×”
    start();
  </script>
</body>
</html>