<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×× ×•×™ ×—×•×“×©×™ â€“ ×¤×¨×˜×™× ×•×”×¨×©××”</title>

  <!-- ×¢×™×¦×•×‘ ×’×œ×•×‘×œ×™ ×‘×”×™×¨ ×•××—×™×“ -->
  <link rel="stylesheet" href="../styles.light.css?v=1" />
  <meta name="theme-color" content="#5b7cfa" />
</head>
<body>
  <div class="wrap">
    <div class="card">

      <!-- ×˜×•×¤Ö¾×‘×¨ ×™×•× ×™×¤×™×™×“ -->
      <div class="topbar">
        <button class="btn" onclick="location.href='../index.html'">×œ×ª×¤×¨×™×˜ ×¨××©×™</button>
      </div>

      <!-- ×›×•×ª×¨×ª -->
      <div class="head">
        <div class="brand">
          <div class="logo">HB</div>
          <div class="title">×× ×•×™ ×—×•×“×©×™ â€“ ×¤×¨×˜×™× ×•×”×¨×©××”</div>
        </div>
      </div>

      <!-- ××–×•×¨ ×”×ª×•×›×Ÿ -->
      <div class="body chat-body" id="area" role="log" aria-live="polite" aria-atomic="false"></div>

      <!-- ×ª×—×ª×™×ª -->
      <div class="footer">
        <button id="backBtn" class="btn" disabled>×—×–×¨×”</button>
        <a id="faqBtn" class="btn ghost" href="../faq.html" target="_blank" rel="noopener">×™×© ×œ×™ ×©××œ×•×ª</a>
        <span class="spacer"></span>
      </div>

    </div>
  </div>

  <!-- ×¡×§×¨×™×¤×˜×™× ××©×•×ª×¤×™× (×›××• ×‘×¢× ×£ 1) -->
  <script src="./js/config.js?v=2"></script>
  <script src="./js/chat-helpers.js?v=2"></script>

  <script>
    /* ===== ×”×ª×××ª ×›×¤×ª×•×¨ ×”â€‘FAQ ×œ×¤×™ ×”×§×©×¨ ===== */
    function setHelpContext(ctx){
      const btn = document.getElementById('faqBtn');
      if(!btn) return;
      const base = '../faq.html';
      btn.href = ctx ? `${base}?ctx=${encodeURIComponent(ctx)}` : base;
    }

    /* ===== ×§×™×©×•×¨×™× ×•×ª×œ×•×™×•×ª (× ×©×ª××© ×‘×§×•× ×¤×™×’ ×× ×§×™×™×, ××—×¨×ª fallback) ===== */
    const REG_LINK   = (window.Chat?.cfg?.REG_LINK)   || 'https://wordpress-1184560-4777160.cloudwaysapps.com/';
    const TERMS_LINK = (window.Chat?.cfg?.TERMS_LINK) || 'https://forms.gle/orUvvLrrSuCGAPVVA';

    /* ===== ×–×¨×™××” ===== */
    function start(){
      setHelpContext('plan');    // ×¢×–×¨×” ×›×œ×œ×™×ª ×¢×œ ××¡×œ×•×œ×™×/×× ×•×™
      Chat.clear(); Chat.push(start);

      Chat.typingThen(
        '<strong>×”×™×™! ×× ×•×™ ×—×•×“×©×™ ×‘××¨×›×– ×‘×¨××•× ×©×˜×™×™×Ÿ ğŸ‘¨â€ğŸš€</strong><br>' +
        '×›××” ×¤×¨×˜×™× ××”×™×¨×™× ×›×“×™ ×©× ×•×›×œ ×œ×—×–×•×¨ ××œ×™×™×š, ×•××– × ×¡×‘×™×¨ ××™×š ×–×” ×¢×•×‘×“.',
        700, true
      );

      setTimeout(stepLead, 900);
    }

    // ×©×œ×‘ 1 â€” ×¤×¨×˜×™ ×§×©×¨ (×©× ××œ×, ×˜×œ×¤×•×Ÿ, ×”×¢×¨×•×ª ×¨×©×•×ª)
    function stepLead(){
      setHelpContext('contact');
      Chat.clear(); Chat.push(stepLead);

      const anchor = Chat.botHTML('<span class="muted">×¤×¨×˜×™ ×§×©×¨</span>');
      Chat.scrollStartOf(anchor);

      const fullName = Chat.inputRow('×©× ××œ×', {
        id:'fullName', placeholder:'×œ×“×•×’××”: ×“× ×” ×œ×•×™', required:true, autocomplete:'name'
      });
      const phone = Chat.inputRow('×˜×œ×¤×•×Ÿ ×œ×—×–×¨×”', {
        type:'tel', id:'phone', placeholder:'×œ×“×•×’××”: 0501234567', required:true, autocomplete:'tel', inputmode:'tel'
      });
      const notes = Chat.inputRow('×”×¢×¨×•×ª (×œ× ×—×•×‘×”)', {
        textarea:true, id:'lead_notes', placeholder:'×›×œ ×“×‘×¨ ×©×—×©×•×‘ ×©× ×“×¢'
      });

      const next = Chat.button('×”××©×š', async ()=>{
        Chat.userBubble('×”××©×š');

        const fn  = (fullName.value||'').trim();
        const tel = Chat.normalizeILPhone(phone.value||'');

        if(!fn){  Chat.botText('×™×© ×œ×”×–×™×Ÿ ×©× ××œ× âœï¸').classList.add('err'); fullName.focus(); return; }
        if(!Chat.validILPhone(tel)){ Chat.botText('××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ ğŸ“').classList.add('err'); phone.focus(); return; }

        const stop = Chat.showProcessing('×©×•××¨ ×œ××–×›×™×¨×•×ªâ€¦');

        const ok = await Chat.sendLeadToSheet({
          path: '×× ×•×™ ×—×•×“×©×™ â€“ ×”×ª×¢× ×™×™× ×•×ª',
          fullName: fn,
          phone: tel,
          message: (notes.value||'').trim(),
          extraNotes: '',
          cta: '×”×ª×¢× ×™×™× ×•×ª ×‘×× ×•×™ ×—×•×“×©×™',
          source: '×™×•×¡×˜×•×Ÿ â€“ ××ª×¨',
          status: '×œ×˜×™×¤×•×œ',
          createdAt: new Date().toISOString()
        });

        stop();
        if(ok){
          Chat.botText('×”×¤×¨×˜×™× × ×©××¨×• ×‘×”×¦×œ×—×” âœ…').classList.add('ok');
          setTimeout(stepAbout, 500);
        }else{
          Chat.botText('×œ× ×”×¦×œ×—× ×• ×œ×©××•×¨ ××ª ×”×¤×¨×˜×™× âŒ ××¤×©×¨ ×œ× ×¡×•×ª ×©×•×‘ ××• ×œ×¤× ×•×ª ××œ×™× ×• ×‘×•×•××˜×¡××¤ 050â€‘9570866.').classList.add('err');
          next.disabled = false;
        }
      }, 'btn primary');

      // ×”×¤×¢×œ×” ××—×“×© ×©×œ ×”×›×¤×ª×•×¨ ××—×¨×™ ×ª×™×§×•×Ÿ ×§×œ×˜
      ;[fullName, phone, notes].forEach(el=>{
        el.addEventListener('input', ()=>{ next.disabled = false; });
      });
    }

    // ×©×œ×‘ 2 â€” ××™×š ×¢×•×‘×“×™×
    function stepAbout(){
      setHelpContext('plan');
      Chat.clear(); Chat.push(stepAbout);

      Chat.botHTML(
        '<strong>××™×š ×–×” ×¢×•×‘×“ ××¦×œ× ×•?</strong><br>' +
        'â€¢ ×›×œ ×©×™×¢×•×¨ × ××©×š <strong>50 ×“×§×•×ª</strong> ×•××ª×—×™×œ ×‘×©×¢×” ×¢×’×•×œ×”.<br>' +
        'â€¢ ××©×œ×‘×™× ×—×™×–×•×§ ×—×•××¨ ×›×™×ª×ª×™, ×©×™×¢×•×¨×™ ×‘×™×ª, ×”×›× ×” ×œ××‘×—× ×™× ×•×‘× ×™×™×ª ×‘×™×˜×—×•×Ÿ.<br>' +
        'â€¢ ××¤×©×¨ ×œ×”×ª×§×“× ×‘×§×¦×‘ ×”××™×©×™, ×•×× ×• ××ª××™××™× ××ª ×”×¨××” ×œ×›×œ ×ª×œ××™×“/×” ğŸ¯'
      );

      Chat.button('×”××©×š', stepPrices, 'btn primary');
      Chat.button('×—×–×¨×”', ()=>Chat.goBack?.() || history.back());
    }

    // ×©×œ×‘ 3 â€” ××¡×œ×•×œ×™× ×•××—×™×¨×™× (× ××©×š ××”×§×•× ×¤×™×’ ×× ×§×™×™×)
    function stepPrices(){
      setHelpContext('plan');
      Chat.clear(); Chat.push(stepPrices);

      const P = Chat.cfg?.PRICES || { group: 295, triple: 385, private: 0 };

      Chat.botHTML(
        '<strong>××¡×œ×•×œ×™× ×•××—×™×¨×™×</strong><br>' +
        `â€¢ ×§×‘×•×¦×ª×™ (×¢×“ 5 ×ª×œ××™×“×™×): <strong>${P.group} â‚ª / ×—×•×“×©</strong><br>` +
        `â€¢ ×˜×¨×™×¤×œ (×¢×“ 3 ×ª×œ××™×“×™×): <strong>${P.triple} â‚ª / ×—×•×“×©</strong><br><br>` +
        '×¨×•×¦×” ×œ×˜×¢×•× ×œ×¤× ×™ ×©××ª×—×™×™×‘×™×?<br>' +
        '<strong>×©×™×¢×•×¨ ×—×“Ö¾×¤×¢××™</strong> ×¢×œ ×‘×¡×™×¡ ××§×•× ×¤× ×•×™: 80 â‚ª (×§×‘×•×¦×ª×™) / 100 â‚ª (×˜×¨×™×¤×œ).'
      );

      Chat.button('×”××©×š', stepRegister, 'btn primary');
      Chat.button('×—×–×¨×”', ()=>Chat.goBack?.() || history.back());
    }

    // ×©×œ×‘ 4 â€” ×”×¨×©××” / ×—×œ×•×¤×•×ª
    function stepRegister(){
      setHelpContext('review');   // ×‘â€‘FAQ ×™×© ×’× ×¤×¨×§ Review/×”×¨×©××”
      Chat.clear(); Chat.push(stepRegister);

      Chat.botText('×œ×”×¦×˜×¨×¤×•×ª ××”×™×¨×” ×œ×× ×•×™ â€“ ×¤×ª×—×™ ××ª ×˜×•×¤×¡ ×”×¨×™×©×•× (×œ××™×œ×•×™ ×§×¦×¨):');

      Chat.button('×¤×ª×—/×™ ××ª ×˜×•×¤×¡ ×”×¨×™×©×•× ğŸ“', ()=>{
        Chat.userBubble('×¤×ª×—/×™ ××ª ×˜×•×¤×¡ ×”×¨×™×©×•×');
        window.open(REG_LINK, '_blank', 'noopener,noreferrer');
      }, 'btn primary');

      Chat.button('××©×œ×™×/×” ××ª ×”×˜×•×¤×¡ ×××•×—×¨ ×™×•×ª×¨ â³', ()=>{
        Chat.userBubble('××©×œ×™×/×” ×××•×—×¨ ×™×•×ª×¨');
        Chat.typingThen('×¡×’×•×¨ ğŸ™‚ ×©××¨×ª×™ ××ª ×”×¤×¨×˜×™× ×•× ×—×–×•×¨ ××œ×™×™×š ×‘×”×§×“×.', 650, true);
      });

      Chat.button('×‘××§×•× ×–××ª: ×©×™×¢×•×¨ ×—×“Ö¾×¤×¢××™ ×¢×›×©×™×•', ()=>{
        Chat.userBubble('×©×™×¢×•×¨ ×—×“Ö¾×¤×¢××™');
        setTimeout(()=> location.href='./branch1.html', 200);
      });

      // ×§×™×©×•×¨ ×œ×ª×§× ×•×Ÿ â€“ ××•×¤×¦×™×•× ×œ×™
      const s = document.createElement('div'); s.className='summary';
      s.appendChild(Chat.chip('×§×™×©×•×¨ ×œ×ª×§× ×•×Ÿ'));
      const a = document.createElement('a');
      a.href = TERMS_LINK; a.target='_blank'; a.rel='noopener';
      a.textContent = '×ª× ××™ ×”×ª×§× ×•×Ÿ';
      a.style.marginInlineStart = '6px';
      const wrap = document.createElement('div'); wrap.className='bubble bot'; wrap.appendChild(a);
      document.getElementById('area').appendChild(s);
      document.getElementById('area').appendChild(wrap);
      (function(){ const a=document.getElementById('area'); a.scrollTop=a.scrollHeight; })();

      Chat.button('×—×–×¨×”', ()=>Chat.goBack?.() || history.back());
    }

    // ×”×¤×¢×œ×”
    start();
  </script>
</body>
</html>