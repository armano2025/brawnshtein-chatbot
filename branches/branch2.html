<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×× ×•×™ ×—×•×“×©×™ â€“ ×¤×¨×˜×™× ×•×”×¨×©××”</title>

  <!-- ×¢×™×¦×•×‘ ×’×œ×•×‘×œ×™ ×‘×”×™×¨ ×•××—×™×“ -->
  <link rel="stylesheet" href="../styles.light.css?v=1" />
  <meta name="theme-color" content="#5b7cfa" />

  <!-- ××¢×˜ ×¡×’× ×•× ×•×ª ×¤× ×™××™×™× ×œ××¡×š ×”××§×¦×•×¢×•×ª ×•×”××•×“××œ -->
  <style>
    /* ×’×¨×™×“ ××§×¦×•×¢×•×ª */
    .subjects-grid{
      display:grid; gap:10px; margin-top:6px;
      grid-template-columns: 1fr;
    }
    @media (min-width:560px){ .subjects-grid{ grid-template-columns: 1fr 1fr } }
    @media (min-width:920px){ .subjects-grid{ grid-template-columns: 1fr 1fr 1fr } }

    .subject-card{
      background:#fff; border:1px solid var(--border);
      border-radius:12px; padding:12px 14px; cursor:pointer;
      box-shadow: 0 6px 14px rgba(15,23,42,0.06);
      transition: transform var(--speed), border-color var(--speed), box-shadow var(--speed);
      display:flex; align-items:center; gap:10px;
    }
    .subject-card:hover{ transform: translateY(-1px); border-color: var(--primary); box-shadow: 0 8px 18px rgba(15,23,42,0.10) }
    .subject-emoji{ font-size:18px; }
    .subject-title{ font-weight:700; }

    /* ××•×“××œ ××™×“×¢ ××§×¦×•×¢ */
    .modal{
      position:fixed; inset:0; z-index:50;
      background: rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:center;
      padding: 18px;
    }
    .modal-card{
      max-width: 640px; width:100%;
      background: var(--glass); border:1px solid var(--border);
      border-radius: 16px; box-shadow: var(--shadow);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px; border-bottom:1px solid var(--border);
      background: linear-gradient(135deg, rgba(91,124,250,.14), rgba(124,91,250,.10));
      font-weight:800;
    }
    .modal-body{ padding:12px 14px; line-height:1.8; color: var(--text) }
    .modal-actions{
      display:flex; gap:8px; justify-content:flex-end; padding:12px 14px; border-top:1px solid var(--border);
      background: #ffffff;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <!-- ×˜×•×¤Ö¾×‘×¨ (×›××• ×‘×¢× ×£ 1) -->
      <div class="topbar">
        <button class="btn" onclick="location.href='../index.html'">×œ×ª×¤×¨×™×˜ ×¨××©×™</button>
      </div>

      <!-- ×›×•×ª×¨×ª -->
      <div class="head">
        <div class="brand">
          <div class="logo">HB</div>
          <div class="title">×× ×•×™ ×—×•×“×©×™ â€“ ×¤×¨×˜×™× ×•×”×¨×©××”</div>
        </div>
      </div>

      <!-- ××–×•×¨ ×”×ª×•×›×Ÿ -->
      <div class="body chat-body" id="area" role="log" aria-live="polite" aria-atomic="false"></div>

      <!-- ×ª×—×ª×™×ª: ×—×–×¨×” + ×©××œ×•×ª (FAQ) -->
      <div class="footer">
        <button id="backBtn" class="btn" disabled>×—×–×¨×”</button>
        <a id="faqBtn" class="btn ghost" href="../faq.html" target="_blank" rel="noopener">×™×© ×œ×™ ×©××œ×•×ª</a>
        <span class="spacer"></span>
      </div>

    </div>
  </div>

  <!-- ×¡×§×¨×™×¤×˜×™× ××©×•×ª×¤×™× (×›××• ×‘×¢× ×£ 1) -->
  <script src="./js/config.js?v=2"></script>
  <script src="./js/chat-helpers.js?v=2"></script>

  <script>
    /* ===== ×”×ª×××ª ×›×¤×ª×•×¨ ×”-FAQ ×œ×¤×™ ×”×§×©×¨ ===== */
    function setHelpContext(ctx){
      const btn = document.getElementById('faqBtn');
      if(!btn) return;
      const base = '../faq.html';
      btn.href = ctx ? `${base}?ctx=${encodeURIComponent(ctx)}` : base;
    }

    /* ===== ×§×™×©×•×¨×™× ××ª×¦×•×¨×” (×¢× fallback) ===== */
    const REG_LINK   = (window.Chat?.cfg?.REG_LINK)   || 'https://wordpress-1184560-4777160.cloudwaysapps.com/';
    const TERMS_LINK = (window.Chat?.cfg?.TERMS_LINK) || 'https://forms.gle/orUvvLrrSuCGAPVVA';

    /* ===== ×ª×•×›×Ÿ ××§×¦×•×¢×•×ª ×•×ª×™××•×¨×™× (× ×™×ª×Ÿ ×œ×”×¨×—×™×‘/×œ×¢×“×›×Ÿ) ===== */
    const SUBJECTS = (Chat?.cfg?.SUBJECTS && Chat.cfg.SUBJECTS.length)
      ? Chat.cfg.SUBJECTS
      : ['××ª××˜×™×§×”','×× ×’×œ×™×ª','×× ×’×œ×™×ª ××“×•×‘×¨×ª ×œ×§×˜× ×˜× ×™×','×œ×©×•×Ÿ','×¡×¤×¨×•×ª','×”×™×¡×˜×•×¨×™×”','×ª× "×š','×¤×™×–×™×§×”','×›×™××™×”','×‘×™×•×œ×•×’×™×”','××“×¢×™ ×”××—×©×‘'];

    const SUBJECT_INFO = {
      '××ª××˜×™×§×”': '×™×™×©×•×¨ ×§×• ×‘×—×•××¨ ×”×›×™×ª×ª×™, ×‘× ×™×™×ª ×‘×¡×™×¡ ×—×–×§, ××¡×˜×¨×˜×’×™×•×ª ×¤×ª×¨×•×Ÿ ×•×ª×¨×’×•×œ ×××•×§×“ â€” ×¢× ×“×’×© ×¢×œ ×‘×™×˜×—×•×Ÿ ×¢×¦××™ ×•×”×›× ×” ×œ××‘×—× ×™×.',
      '×× ×’×œ×™×ª': '×©×¤×” ×—×™×”: ××•×¦×¨ ××™×œ×™×, ×“×§×“×•×§ ×©×™××•×©×™, ×§×¨×™××” ×•×”×‘× ×ª ×”× ×§×¨×, ×›×ª×™×‘×” ×•×“×™×‘×•×¨ â€” ×‘×§×¦×‘ ××™×©×™ ×•×ª×™×§×•×Ÿ ×˜×¢×•×™×•×ª ×¢×“×™×Ÿ.',
      '×× ×’×œ×™×ª ××“×•×‘×¨×ª ×œ×§×˜× ×˜× ×™×': '××¡×œ×•×œ ××©×—×§×™ ×•×—×•×•×™×™×ª×™: ×¦×œ×™×œ×™×, ××™×œ×™× ×¨××©×•× ×•×ª, ×©×™×¨×™× ×•××©×—×§×™ ×“×™×‘×•×¨ ×œ×”×˜××¢×” ×˜×‘×¢×™×ª ××’×™×œ ×¦×¢×™×¨.',
      '×œ×©×•×Ÿ': '×›×œ×™× ×¤×¨×§×˜×™×™× ×œ×”×‘× ×” ×•×”×‘×¢×”, ×ª×—×‘×™×¨, × ×™×ª×•×— ×˜×§×¡×˜×™× ×•×“×™×•×§ ×‘×©×¤×” â€” ×›×“×™ ×œ×›×ª×•×‘ ×•×œ× ×¡×— ×‘×‘×™×˜×—×•×Ÿ.',
      '×¡×¤×¨×•×ª': '×§×¨×™××” ××•× ×—×™×ª, ×”×‘× ×ª ×©×›×‘×•×ª ×‘×˜×§×¡×˜, ×›×œ×™× ×œ× ×™×ª×•×— ×•×›×ª×™×‘×ª ×ª×©×•×‘×•×ª ××œ××•×ª ×•××“×•×™×§×•×ª.',
      '×”×™×¡×˜×•×¨×™×”': '×¦×™×¨×™ ×–××Ÿ, ×”×§×©×¨×™×, ××™×¨×•×¢×™× ×•××•×©×’×™× â€” ××™×š ××¡×¤×¨×™× ×¡×™×¤×•×¨ ×‘×¨×•×¨ ×•×¢×•× ×™× ×ª×©×•×‘×” ×©××§×‘×œ×ª × ×§×•×“×•×ª.',
      '×ª× "×š': '×§×¨×™××” ××•× ×—×™×ª, ×¤×™×¨×•×© ××•×©×’×™× ×•×”×‘× ×ª ×¤×¨×§×™× ×œ×¢×•××§, ×¢× ×˜×›× ×™×§×•×ª ×–×™×›×¨×•×Ÿ ×•×§×™×©×•×¨×™×•×ª.',
      '×¤×™×–×™×§×”': '×”×‘× ×ª ×¢×§×¨×•× ×•×ª, ×¤×™×¨×•×§ ×‘×¢×™×•×ª ×©×œ×‘×™×-×©×œ×‘×™×, ×ª×¨×’×•×œ ×©×™×˜×ª×™ ×•×”×›× ×” ×œ×‘×—×™× ×•×ª.',
      '×›×™××™×”': '××•×œ×§×•×œ×•×ª, ×ª×’×•×‘×•×ª, ×—×™×©×•×‘×™× â€” ×ª×¨×’×•×œ ××•×“×¨×š ×©××¤×©×˜ × ×•×©××™× ×××ª×’×¨×™× ×•××—×–×§ ××™×•×× ×•×™×•×ª ×¤×ª×¨×•×Ÿ.',
      '×‘×™×•×œ×•×’×™×”': '××¢×¨×›×•×ª ×’×•×£, ×ª××™× ×•×ª×”×œ×™×›×™× â€” ×œ×™××•×“ ×‘×”×™×¨ ×¢× ×“×•×’×××•×ª ×¨×œ×•×•× ×˜×™×•×ª ×•×ª×¨×’×•×œ ×œ××‘×—× ×™×.',
      '××“×¢×™ ×”××—×©×‘': '×œ×•×’×™×§×” ××œ×’×•×¨×™×ª××™×ª, ×™×¡×•×“×•×ª ×ª×›× ×•×ª ×•×ª×¨×’×•×œ ××¢×©×™ â€” ×‘×”×ª×× ×œ×¨××” ×•×œ×¡×™×œ×‘×•×¡ ×”×›×™×ª×ª×™.'
    };

    const SUBJECT_EMOJI = {
      '××ª××˜×™×§×”':'ğŸ§®','×× ×’×œ×™×ª':'ğŸ—£ï¸','×× ×’×œ×™×ª ××“×•×‘×¨×ª ×œ×§×˜× ×˜× ×™×':'ğŸˆ','×œ×©×•×Ÿ':'âœï¸','×¡×¤×¨×•×ª':'ğŸ“–',
      '×”×™×¡×˜×•×¨×™×”':'ğŸ—ºï¸','×ª× "×š':'ğŸ“œ','×¤×™×–×™×§×”':'âš›ï¸','×›×™××™×”':'ğŸ§ª','×‘×™×•×œ×•×’×™×”':'ğŸ§¬','××“×¢×™ ×”××—×©×‘':'ğŸ’»'
    };

    /* ===== ××•×“××œ ××™×“×¢ ×§×¦×¨ ===== */
    function openSubjectModal(title, html){
      const wrap = document.createElement('div');
      wrap.className = 'modal';
      wrap.setAttribute('role','dialog');
      wrap.setAttribute('aria-modal','true');

      const card = document.createElement('div');
      card.className = 'modal-card';

      const head = document.createElement('div');
      head.className = 'modal-head';
      head.innerHTML = `<div>${title}</div>`;

      const body = document.createElement('div');
      body.className = 'modal-body';
      body.innerHTML = html;

      const actions = document.createElement('div');
      actions.className = 'modal-actions';
      const closeBtn = document.createElement('button');
      closeBtn.className = 'btn';
      closeBtn.textContent = '×¡×’×•×¨';
      closeBtn.onclick = ()=> wrap.remove();
      actions.appendChild(closeBtn);

      card.append(head, body, actions);
      wrap.appendChild(card);

      wrap.addEventListener('click', (e)=>{ if(e.target===wrap) wrap.remove(); });
      document.addEventListener('keydown', function onEsc(ev){ if(ev.key==='Escape'){ wrap.remove(); document.removeEventListener('keydown', onEsc); } });

      document.body.appendChild(wrap);
      closeBtn.focus();
    }

    /* ===== ×”×ª×—×œ×” ===== */
    function start(){
      setHelpContext('contact');
      Chat.clear(); Chat.push(start);

      Chat.typingThen(
        '<strong>×”×™×™! ×× ×•×™ ×—×•×“×©×™ ×‘××¨×›×– ×‘×¨××•× ×©×˜×™×™×Ÿ ğŸ‘¨â€ğŸš€</strong><br>' +
        '× ×ª×—×™×œ ××¤×¨×˜×™ ×§×©×¨ ×§×¦×¨×™× ×›×“×™ ×©× ×•×›×œ ×œ×—×–×•×¨ ××œ×™×š.',
        650, true
      );

      setTimeout(stepContact, 850);
    }

    /* ===== ×©×œ×‘ 1: ×¤×¨×˜×™ ×§×©×¨ (×›××• ×‘×¢× ×£ 1) ===== */
    async function stepContact(){
      setHelpContext('contact');
      Chat.clear(); Chat.push(stepContact);

      const header = Chat.botHTML('<strong>×¤×¨×˜×™ ×§×©×¨</strong><br><span class="muted">×©× ×¤×¨×˜×™, ×©× ××©×¤×—×” ×•××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ×—×–×¨×”</span> ğŸ‘¨â€ğŸš€');
      Chat.scrollStartOf(header);

      await waitP(250);
      const firstName = Chat.inputRow('×©× ×¤×¨×˜×™',   { id:'firstName', placeholder:'×œ×“×•×’××”: ×“× ×”', required:true, autocomplete:'given-name' });
      await waitP(120);
      const lastName  = Chat.inputRow('×©× ××©×¤×—×”',  { id:'lastName',  placeholder:'×œ×“×•×’××”: ×œ×•×™', required:true, autocomplete:'family-name' });
      await waitP(120);
      const phone     = Chat.inputRow('×˜×œ×¤×•×Ÿ ×œ×—×–×¨×”',{ type:'tel', id:'phone', placeholder:'×œ×“×•×’××”: 0501234567', required:true, autocomplete:'tel', inputmode:'tel' });

      await waitP(120);
      const btnNext = Chat.button('×”××©×š', async ()=>{
        Chat.userBubble('×”××©×š');

        const fn  = (firstName.value||'').trim();
        const ln  = (lastName.value||'').trim();
        const tel = Chat.normalizeILPhone(phone.value||'');

        if(!fn){  inlineErr('× ×“×¨×© ×©× ×¤×¨×˜×™ âœï¸', firstName); return; }
        if(!ln){  inlineErr('× ×“×¨×© ×©× ××©×¤×—×” âœï¸', lastName); return; }
        if(!Chat.validILPhone(tel)){ inlineErr('××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ ğŸ“', phone); return; }

        Chat.State.data.firstName = fn;
        Chat.State.data.lastName  = ln;
        Chat.State.data.fullName  = `${fn} ${ln}`.trim();
        Chat.State.data.phone     = tel;

        // × ×©××•×¨ ×œ××–×›×™×¨×•×ª (×›××• ×‘×¢× ×£ 1)
        const stop = Chat.showProcessing('×©×•××¨ ×œ××–×›×™×¨×•×ªâ€¦');
        const ok = await Chat.sendLeadToSheet({
          path: '×× ×•×™ ×—×•×“×©×™ â€“ ×”×ª×¢× ×™×™× ×•×ª',
          fullName: Chat.State.data.fullName,
          firstName: fn,
          lastName: ln,
          phone: tel,
          message: '', extraNotes: '',
          cta: '×”×ª×¢× ×™×™× ×•×ª ×‘×× ×•×™ ×—×•×“×©×™',
          source: '×™×•×¡×˜×•×Ÿ â€“ ××ª×¨',
          status: '×œ×˜×™×¤×•×œ',
          createdAt: new Date().toISOString()
        });
        stop();
        if(!ok){
          Chat.botText('×œ× ×”×¦×œ×—× ×• ×œ×©××•×¨ ××ª ×”×¤×¨×˜×™× âŒ ××¤×©×¨ ×œ×”××©×™×š ×‘×›×œ ×–××ª, ××‘×œ × ×©××— ×œ× ×¡×•×ª ×©×•×‘ ×‘×”××©×š.').classList.add('err');
        }

        stepSubjects();
      }, 'btn primary');

      [firstName, lastName, phone].forEach(el=>{
        el.addEventListener('input', ()=>{ removeLastErr(); btnNext.disabled = false; });
      });

      function inlineErr(msg, el){ Chat.botText(msg).classList.add('err'); el.focus(); }
      function removeLastErr(){
        const area = document.getElementById('area');
        const lastErr = [...area.querySelectorAll('.bubble.err, .err')].pop();
        if(lastErr) lastErr.remove();
      }
      function waitP(ms){ return new Promise(r=>setTimeout(r, ms)); }
    }

    /* ===== ×©×œ×‘ 2: ××§×¦×•×¢×•×ª (×’×¨×™×“ + ××•×“××œ×™×) ===== */
    function stepSubjects(){
      setHelpContext('subject');
      Chat.clear(); Chat.push(stepSubjects);

      const name = Chat.State.data.firstName ? `, ${Chat.State.data.firstName}` : '';
      Chat.typingThen(
        `<strong>×‘××™×–×” ××§×¦×•×¢ ×ª×¨×¦×• ×œ×™×•×•×™ ×§×‘×•×¢${name}?</strong><br>` +
        `<span class="muted">×œ×—×™×¦×” ×¢×œ ××§×¦×•×¢ ×ª×¤×ª×— ×”×¡×‘×¨ ×§×¦×¨ ×¢×œ ××•×¤×Ÿ ×”×œ×™××•×“ ××¦×œ× ×•.</span>`,
        650, true
      );

      setTimeout(()=>{
        const host = document.createElement('div');
        host.className = 'bubble bot';
        const grid = document.createElement('div');
        grid.className = 'subjects-grid';

        SUBJECTS.forEach(title=>{
          const card = document.createElement('button');
          card.type = 'button';
          card.className = 'subject-card';
          card.innerHTML = `
            <span class="subject-emoji">${SUBJECT_EMOJI[title] || 'ğŸ“š'}</span>
            <span class="subject-title">${title}</span>
          `;
          card.addEventListener('click', ()=>{
            const text = SUBJECT_INFO[title] || '×œ×™××•×“ ××•×ª××-××™×©×™×ª: ×—×™×–×•×§ ×™×¡×•×“×•×ª, ×ª×¨×’×•×œ ××•×“×¨×š ×•×”×›× ×” ×œ××‘×—× ×™× â€“ ×‘×§×¦×‘ × ×¢×™× ×•×‘×¨×•×¨.';
            openSubjectModal(title, `<p>${text}</p>`);
          });
          grid.appendChild(card);
        });

        host.appendChild(grid);
        document.getElementById('area').appendChild(host);
        (function(){ const a=document.getElementById('area'); a.scrollTop=a.scrollHeight; })();

        Chat.button('×”××©×š', stepRegistration, 'btn primary');
        const s = document.createElement('div'); s.className='summary';
        s.appendChild(Chat.chip('×× ×•×™ ×—×•×“×©×™'));
        document.getElementById('area').appendChild(s);
      }, 800);
    }

    /* ===== ×©×œ×‘ 3: ×§×™×©×•×¨ ×œ×”××©×š ××“×•×™×§ (×”×¤× ×™×” ×œ×¨×™×©×•×) ===== */
    function stepRegistration(){
      setHelpContext('review'); // ×‘-FAQ ×–×” ×”×”×§×©×¨ ×”×›×™ ×§×¨×•×‘
      Chat.clear(); Chat.push(stepRegistration);

      Chat.botHTML(
        '<strong>×œ×”××©×š ××“×•×™×§ ×©×œ ×”×¦×¨×›×™× ×•×”×¨×¦×•× ×•×ª</strong><br>' +
        '× ×‘×§×© ×œ×”×™×›× ×¡ ×œ×˜×•×¤×¡ ×”×”××©×š ×”×§×¦×¨ ×©×œ× ×•. ×›×š × ×ª××™× ×¢×‘×•×¨×š ××ª ×”××•×¨×”, ×”×¨××” ×•×”×©×¢×•×ª ×‘×¦×•×¨×” ×”×˜×•×‘×” ×‘×™×•×ª×¨.'
      );

      Chat.button('×¤×ª×—/×™ ××ª ×˜×•×¤×¡ ×”×”××©×š ğŸ“', ()=>{
        Chat.userBubble('×¤×ª×—/×™ ××ª ×˜×•×¤×¡ ×”×”××©×š');
        window.open(REG_LINK, '_blank', 'noopener,noreferrer');
        // ×œ×•×’ ×§×¦×¨ × ×•×¡×£ (×œ× ×—×•×‘×”)
        Chat.sendLeadToSheet?.({
          path: '×× ×•×™ ×—×•×“×©×™ â€“ ××¢×‘×¨ ×œ×˜×•×¤×¡',
          fullName: Chat.State.data.fullName || '',
          phone: Chat.State.data.phone || '',
          message: '× ×¤×ª×— ×˜×•×¤×¡ ×”××©×š ××”×¨×•×‘×•×˜',
          cta: '×¤×ª×™×—×ª ×˜×•×¤×¡',
          source: '×™×•×¡×˜×•×Ÿ â€“ ××ª×¨',
          status: '×œ×˜×™×¤×•×œ',
          createdAt: new Date().toISOString()
        });
      }, 'btn primary');

      Chat.button('××¡×™×™× ×××•×—×¨ ×™×•×ª×¨ â³', ()=>{
        Chat.userBubble('××¡×™×™× ×××•×—×¨ ×™×•×ª×¨');
        Chat.typingThen('×¡×’×•×¨ ğŸ™‚ ×©××¨×ª×™ ××ª ×”×¤×¨×˜×™× ×•× ×™×¦×•×¨ ×§×©×¨ ×‘×§×¨×•×‘ ×œ×¢×–×¨×” ×‘×”×©×œ××ª ×”×”×¨×©××”.', 650, true);
      });

      // ×¡×™×•× ×™×¤×”
      const wrap = document.createElement('div'); wrap.className='bubble bot';
      wrap.innerHTML =
        '<div class="summary" style="margin-bottom:10px;">' +
          '<span class="chip">×©×™×¢×•×¨ = 50 ×“×§×³</span>' +
          '<span class="chip">××³â€“×”×³ 14:00â€“21:00</span>' +
          '<span class="chip">×”×ª×××” ××™×©×™×ª</span>' +
        '</div>' +
        '<div class="muted">×™×© ×©××œ×•×ª? ×ª××™×“ ××¤×©×¨ ×œ×¤× ×•×ª ××œ×™× ×• â€” × ×©××— ×œ×¢×–×•×¨ ğŸ’¬</div>';
      document.getElementById('area').appendChild(wrap);
      (function(){ const a=document.getElementById('area'); a.scrollTop=a.scrollHeight; })();

      Chat.button('×—×–×¨×” ×œ×ª×¤×¨×™×˜ ×”×¨××©×™', ()=> location.href='../index.html');
    }

    // ×”×¤×¢×œ×”
    start();
  </script>
</body>
</html>